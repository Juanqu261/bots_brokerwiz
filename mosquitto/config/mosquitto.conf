# Mosquitto MQTT Broker Configuration
# ====================================
# Este archivo es para DESARROLLO LOCAL
# En producción Linux, el script scripts/mosquitto.sh genera la configuración.
#
# Ubicaciones típicas:
#   Windows/Docker: ./mosquitto/config/mosquitto.conf
#   Linux prod:     /etc/mosquitto/conf.d/brokerwiz.conf

# ============================================================================
# LISTENER
# ============================================================================

listener 1883 0.0.0.0
protocol mqtt
allow_anonymous true

# ============================================================================
# PERSISTENCIA (crítico para recuperación ante caídas)
# ============================================================================
# - Los workers usan clean_session=False para recuperar mensajes pendientes
# - Mosquitto guarda mensajes QoS 1/2 para clientes desconectados
# - autosave_interval: cada cuántos segundos guarda a disco

persistence true
persistence_location /mosquitto/data/
persistence_file mosquitto.db
autosave_interval 60

# ============================================================================
# COLAS Y LÍMITES
# ============================================================================
# max_queued_messages: mensajes en cola por cliente desconectado
# max_inflight_messages: mensajes en vuelo simultáneos

max_queued_messages 1000
max_inflight_messages 100
max_keepalive 60

# ============================================================================
# LOGGING
# ============================================================================

log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_timestamp true

