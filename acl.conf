# MQTT Access Control List (ACL) para Mosquitto
# Basado en: https://mosquitto.org/man/mosquitto-acl-7.html

# Sintaxis:
# user <username>
# topic [read|write] <topic>
#
# pattern [read|write] <topic_pattern>
#   %c = client_id
#   %u = username

# ============================================================================
# USUARIOS & PERMISOS
# ============================================================================

# API Server - Publicar tareas en todas las colas
user api
  topic write bots/queue/+
  topic write bots/queue/#
  topic read bots/clients/status

# Worker HDI - Suscribirse solo a HDI
user worker_hdi
  topic read bots/queue/hdi
  topic write bots/clients/status

# Worker Monterrey - Suscribirse solo a Monterrey
user worker_monterrey
  topic read bots/queue/seguros_monterrey
  topic write bots/clients/status

# Worker Genérico - Suscribirse a todas las aseguradoras
user worker_generic
  topic read bots/queue/+
  topic write bots/clients/status

# Admin - Acceso total
user admin
  topic read #
  topic write #

# ============================================================================
# PATRONES (Username-based)
# ============================================================================

# Permitir cliente ver su propio topic
pattern read $SYS/broker/clients/%c/+
pattern write bots/clients/%c/status

# ============================================================================
# ACCESO ANONIMO (si se habilita)
# ============================================================================

# user (aplicado para conexiones sin autenticación)
# topic read bots/queue/public
# topic write $SYS/broker/connection/anonymous

# ============================================================================
# DENEGAR TODO POR DEFECTO
# ============================================================================

# Si user no se menciona en ACL, se le niega todo acceso
# Comentar esta línea para permitir acceso anonymous
# user default
#   topic deny #
