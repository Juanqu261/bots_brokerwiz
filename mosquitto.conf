# Mosquitto MQTT Broker Configuration - Producción con TLS y Autenticacion
# Basado en: https://mosquitto.org/man/mosquitto-conf-5.html

# Listener sin TLS (local development)
listener 1883
  allow_anonymous true
  max_connections -1
  max_queued_messages 1000

# Listener con TLS (producción)
# listener 8883 0.0.0.0
#   protocol mqtt
#   cafile /mosquitto/certs/ca.crt
#   certfile /mosquitto/certs/server.crt
#   keyfile /mosquitto/certs/server.key
#   require_certificate false
#   use_identity_as_username false
#   max_connections -1

# ============================================================================
# AUTENTICACION & AUTORIZACION
# ============================================================================

# ACL file para control granular de acceso
# acl_file /mosquitto/config/acl.conf

# Password file (use: mosquitto_passwd -c file.txt username)
# password_file /mosquitto/config/passwords.txt

# ============================================================================
# PERSISTENCIA
# ============================================================================

# NO guardar mensajes en disco (ephemeral queue)
persistence false

# Archivo de persistencia (si persistence=true)
# persistence_file mosquitto.db

# Directorio de persistencia
# persistence_location /mosquitto/data/

# ============================================================================
# LOGGING
# ============================================================================

# Nivel de log: debug, info, notice, warning, error (default: notice)
log_dest file /mosquitto/logs/mosquitto.log
log_dest stdout
log_type all
log_timestamp true

# ============================================================================
# LIMITES Y TIMEOUTS
# ============================================================================

# Keep-alive por defecto (segundos)
max_keepalive 60

# Timeout de inactividad (segundos)
connect_async_timeout 0
disconnect_timeout 5

# Tamaño máximo de payload (bytes, default: 268435455 = 256MB)
max_queued_messages 1000

# ============================================================================
# PUENTE (para conectar multiples brokers)
# ============================================================================

# connection mybroker
#   address broker.example.com:1883
#   clientid my_client_id
#   start_type automatic

# ============================================================================
# MQTT 5
# ============================================================================

# Habilitar MQTT 5 (recomendado para producción)
# mqtt_version mqtt5

# ============================================================================
# SECURITY - PARA PRODUCCION
# ============================================================================

# Cambiar valores por defecto de credenciales
# allow_anonymous false
# require_certificate false
# use_identity_as_username true
